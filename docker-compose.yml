services:
  postgres:
    image: postgres:17
    environment:
      POSTGRES_USER: pgbouncer
      POSTGRES_PASSWORD: pgbouncer
      POSTGRES_DB: app
    ports:
      - "5433:5432"

  pgbouncer:
    image: edoburu/pgbouncer:latest
    environment:
      DATABASE_URL: postgres://pgbouncer:pgbouncer@postgres:5432/app
      AUTH_TYPE: trust
      IGNORE_STARTUP_PARAMETERS: extra_float_digits
      ADMIN_USERS: pgbouncer
      MAX_CLIENT_CONN: 100
      DEFAULT_POOL_SIZE: 20
    ports:
      - "6432:6432"
    depends_on:
      - postgres
